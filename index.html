<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>diff</title>

		<link rel="icon" href="./magnum.ico" type="image/x-icon">

		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.0.0/diff.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/github.min.css" />
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
		<script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script> -->

		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/perl/perl.min.js"></script>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css" />
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/abbott.min.css" />
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/elegant.min.css" />
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/mdn-like.min.css" /> -->

		<!-- diff -->
		<script src="./npm_modules/diff/dist/diff.js"></script>
		<link rel="stylesheet" href="./npm_modules/highlight.js/styles/github.css" >
		<link rel="stylesheet" href="./npm_modules/diff2html/bundles/css/diff2html.min.css" >
		<script src="./npm_modules/diff2html/bundles/js/diff2html-ui.min.js"></script>
		<!-- mode -->
		<script src="./codemirror/codemirror-5.65.16/lib/codemirror.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/perl/perl.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/python/python.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/clike/clike.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/shell/shell.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/sql/sql.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/markdown/markdown.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/gfm/gfm.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/rst/rst.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/mode/overlay.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/htmlmixed/htmlmixed.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/xml/xml.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/css/css.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/javascript/javascript.js"></script>
		<!-- theme -->
		<link rel="stylesheet" type="text/css" href="./codemirror/codemirror-5.65.16/lib/codemirror.css" >
		<link rel="stylesheet" type="text/css" href="./codemirror/codemirror-5.65.16/theme/abbott.css" >
		<link rel="stylesheet" type="text/css" href="./codemirror/codemirror-5.65.16/theme/elegant.css" >
		<link rel="stylesheet" type="text/css" href="./codemirror/codemirror-5.65.16/theme/eclipse.css" >
		<link rel="stylesheet" type="text/css" href="./codemirror/codemirror-5.65.16/theme/mdn-like.css" >
		<!-- 代码折叠 -->
		<link rel="stylesheet" href="./codemirror/codemirror-5.65.16/addon/fold/foldgutter.css"/>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/foldcode.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/foldgutter.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/brace-fold.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/comment-fold.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/indent-fold.js"></script>
		<!-- search -->
		<link rel="stylesheet" href="./codemirror/codemirror-5.65.16/addon/dialog/dialog.css"/>
		<script src="./codemirror/codemirror-5.65.16/addon/dialog/dialog.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/search/search.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/search/searchcursor.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/search/jump-to-line.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/search/match-highlighter.js"></script>
		<!--全屏模式-->
		<link rel="stylesheet" href="./codemirror/codemirror-5.65.16/addon/display/fullscreen.css">
		<script src="./codemirror/codemirror-5.65.16/addon/display/fullscreen.js"></script>
		<!-- 括号匹配 -->
		<script src="./codemirror/codemirror-5.65.16/addon/edit/matchbrackets.js"></script>

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
		
		<link rel="stylesheet" href="./custom.css"/>
		
	</head>
	<body>
		<div id="page-container">
			<div id="content-wrap">
				<div style="text-align:center;">
					<div class="tooltip fa-regular fa-question-circle">
						<span class="tooltiptext">
							<li>切换主题和语言不会改变 diff。</li>
							<br/>
							<li>光标位于文本框内，F11 全屏（Mac Ctrl-K），Esc 退出全屏。</li>
							<br/>
							<li>光标位于文本框内，Ctrl-F / Cmd-F 搜索，Ctrl-G / Cmd-G 查找下一个，Shift-Ctrl-G / Shift-Cmd-G 查找上一个，Shift-Ctrl-F / Cmd-Option-F 替换，Alt-G 跳到指定行。</li>
						</span>
					</div>
					<select id="code-mode" class="selector" onchange="setLangMode(event)">
						<option value="text/plain">Plain</option>
						<option value="text/x-csrc">C</option>
						<option value="text/x-c++src">C++</option>
						<option value="text/x-python">Python</option>
						<option value="text/x-java">Java</option>
						<option value="text/x-sh">Shell</option>
						<option value="text/x-sql">SQL</option>
						<option value="text/x-markdown">Markdown</option>
						<option value="text/x-rst">Rst</option>
						<option value="text/html">HTML</option>
						<option value="text/css">CSS</option>
						<option value="text/javascript">JavaScript</option>
						<option value="text/x-perl" selected>Perl</option>
					</select>
					<select id="code-theme" class="selector" onchange="setTheme(event)">
						<option value="abbott">Abbott</option>
						<option value="eclipse">Eclipse</option>
						<option value="elegant">Elegant</option>
						<option value="mdn-like" selected>Mdn-like</option>
					</select>
				</div>
				<br>
				<div class="editor-container">
					<div class="editor">
						<textarea id="code1" name="code1"># source</textarea>
					</div>
					<div class="editor">
						<textarea id="code2" name="code2"># target</textarea>
					</div>
				</div>
				<div id="diff" style="tab-size:4"></div>
				<br>
			<div class="back-to-top fa-solid fa-circle-chevron-up" onclick="backToTop()">

			</div>
			</div>
			<footer id="footer"><span style="color: grey;">@@ -a,m +b,n @@</span>: 当前 diff 展示左边文本从第 a 行开始的 m 行、右边文本从第 b 行开始的 n 行</footer>
		</div>
		<script>
			var editor1 = CodeMirror.fromTextArea(document.getElementById('code1'), {
				lineNumbers: true,
				indentUnit: 4,
				mode: 'text/x-perl',
				matchBrackets: true,
				theme: 'mdn-like',
				styleActiveLine: true,
				lineWrapping:true,
				foldGutter: true,
				gutters:["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
				extraKeys: {
					"Ctrl-K": function(cm) {
						cm.setOption("fullScreen", !cm.getOption("fullScreen"));
					},
					"F11": function(cm) {
						cm.setOption("fullScreen", !cm.getOption("fullScreen"));
					},
					"Esc": function(cm) {
						if(cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
					}
				}
			});
			editor1.on('change', () => {
				displayDiff();
			});
			var editor2 = CodeMirror.fromTextArea(document.getElementById('code2'), {
				lineNumbers: true,
				indentUnit: 4,
				mode: 'text/x-perl',
				matchBrackets: true,
				theme: 'mdn-like',
				styleActiveLine: true,
				lineWrapping:true,
				foldGutter: true,
				gutters:["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
				extraKeys: {
					"Ctrl-K": function(cm) {
						cm.setOption("fullScreen", !cm.getOption("fullScreen"));
					},
					"F11": function(cm) {
						cm.setOption("fullScreen", !cm.getOption("fullScreen"));
					},
					"Esc": function(cm) {
						if(cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
					}
				}
			});
			editor2.on('change', () => {
				displayDiff();
			});
			function compareTexts() {
				var t1 = editor1.getDoc().getValue("\n");
				var t2 = editor2.getDoc().getValue("\n");
				var diff = Diff.createPatch("diff", t1, t2);
				return diff;
			}
			function displayDiff(e) {
				var diff = compareTexts();
				var diffContainer = document.getElementById("diff");
				var diffUI = new Diff2HtmlUI(diffContainer, diff, {
					inputFormat: 'diff',
					drawFileList: false,
					matching: 'lines',
					outputFormat: 'side-by-side'
				});
				diffUI.draw();
			}
			function setLangMode(event) {
				var mode = event.target.value;
				editor1.setOption("mode", mode);
				editor2.setOption("mode", mode);
			}
			function setTheme(event) {
				var theme = event.target.value;
				editor1.setOption("theme", theme);
				editor2.setOption("theme", theme);
			}
			window.addEventListener("load", displayDiff);
			function backToTop() {
				window.scroll({
					top: 0,
					// behavior: "smooth"
				})
			}
			window.addEventListener("scroll", function() {
				if(window.pageYOffset > 100) {
					document.querySelector(".back-to-top").classList.add("show");
				} else {
					document.querySelector(".back-to-top").classList.remove("show");
				}
			});
		</script>
	</body>
</html>