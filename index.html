<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>diff</title>

		<link rel="icon" href="./magnum.ico" type="image/x-icon">

		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.0.0/diff.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/github.min.css" />
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
		<script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script> -->

		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/perl/perl.min.js"></script>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css" />
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/abbott.min.css" />
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/elegant.min.css" />
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/mdn-like.min.css" /> -->

		<script src="./node_modules/diff/dist/diff.js"></script>
		<link rel="stylesheet" href="./node_modules/highlight.js/styles/github.css" >
		<link rel="stylesheet" href="./node_modules/diff2html/bundles/css/diff2html.min.css" >
		<script src="./node_modules/diff2html/bundles/js/diff2html-ui.min.js"></script>
		
		<script src="./codemirror/codemirror-5.65.16/lib/codemirror.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/perl/perl.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/python/python.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/clike/clike.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/shell/shell.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/sql/sql.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/markdown/markdown.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/rst/rst.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/htmlmixed/htmlmixed.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/xml/xml.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/css/css.js"></script>
		<script src="./codemirror/codemirror-5.65.16/mode/javascript/javascript.js"></script>
		<link rel="stylesheet" type="text/css" href="./codemirror/codemirror-5.65.16/lib/codemirror.css" >
		<link rel="stylesheet" type="text/css" href="./codemirror/codemirror-5.65.16/theme/abbott.css" >
		<link rel="stylesheet" type="text/css" href="./codemirror/codemirror-5.65.16/theme/mdn-like.css" >

		<link rel="stylesheet" href="./codemirror/codemirror-5.65.16/addon/fold/foldgutter.css"/>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/foldcode.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/foldgutter.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/brace-fold.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/comment-fold.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/fold/indent-fold.js"></script>
		
		<link rel="stylesheet" href="./codemirror/codemirror-5.65.16/addon/dialog/dialog.css"/>
		<script src="./codemirror/codemirror-5.65.16/addon/dialog/dialog.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/search/search.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/search/searchcursor.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/search/jump-to-line.js"></script>
		<script src="./codemirror/codemirror-5.65.16/addon/search/match-highlighter.js"></script>

		<script src="./codemirror/codemirror-5.65.16/addon/edit/matchbrackets.js"></script>
		
		<style>
			body {
				background-color: rgba(247, 247, 249, 0.2);
			}

			#page-container {
				position: relative;
				min-height: 100vh;
			}
			#content-wrap {
				padding-bottom: 2.5rem;
			}
			#footer {
				position: absolute;
				bottom: 0;
				display: flex;
				align-items: center;
				justify-content: center;
				width: 100%;
				height: 2.5rem;
				background-color: rgba(127, 127, 127, 0.2);
			}

			.editor-container {
				display: flex;
				width: 100%;
				margin: 0 auto;
				height: 45vh;
			}
			.editor {
				flex: 1;
				width: 48%;
				margin: 0 1%;
				height: 100%;
			}

			.CodeMirror{
				font-family: consolas, monospace;
				font-size: 18px;
				height: 90%;
			}
			.d2h-diff-table {
				font-size: 16px; /* diff 的字体 */
			}

			.selector {
				text-align: center;
				width: 6.3rem;
				height: 1.5rem;
				font-family: Consolas, monospace;
				font-size: 0.8rem;
				font-weight: bold;
				color: #333;
				border-radius: 0.5rem;
				background-color: rgba(223, 239, 243, 0.2); 
				border: 1px solid #ccc; 
				margin-left: 1%;
				margin-right: 1%;
			}
			select:hover {
				box-shadow: 0px 0px 3px 3px #6d0404;
			}
		</style>
	</head>
	<body>
		<div id="page-container">
			<div id="content-wrap">
				<div style="text-align: center;">
					<select id="code-mode" class="selector" onchange="setLangMode(event)">
						<option value="text/plain">Plain</option>
						<option value="text/x-csrc">C</option>
						<option value="text/x-c++src">C++</option>
						<option value="text/x-python">Python</option>
						<option value="text/x-java">Java</option>
						<option value="text/x-sh">Shell</option>
						<option value="text/x-sql">SQL</option>
						<option value="text/x-markdown">Markdown</option>
						<option value="text/x-rst">Rst</option>
						<option value="text/html">HTML</option>
						<option value="text/css">CSS</option>
						<option value="text/javascript">JavaScript</option>
						<option value="text/x-perl" selected>Perl</option>
					</select>
					<select id="code-theme" class="selector" onchange="setTheme(event)">
						<option value="abbott">Abbott</option>
						<option value="elegant">Elegant</option>
						<option value="mdn-like" selected>Mdn-like</option>
					</select>
				</div>
				<br>
				<div class="editor-container">
					<div class="editor">
						<textarea id="code1" name="code1"># source</textarea>
					</div>
					<div class="editor">
						<textarea id="code2" name="code2"># target</textarea>
					</div>
				</div>
				<div id="diff" style="tab-size:4"></div>
				<br>
			</div>
			<footer id="footer"><span style="color: grey;">@@ -a,m +b,n @@</span>: 当前 diff 展示左边文本从第 a 行开始的 m 行、右边文本从第 b 行开始的 n 行</footer>
		</div>
		<script>
			var interval = 0;
			var editor1 = CodeMirror.fromTextArea(document.getElementById('code1'), {
				lineNumbers: true,
				indentUnit: 4,
				mode: 'text/x-perl',
				matchBrackets: true,
				theme: 'mdn-like',
				styleActiveLine: true,
				lineWrapping:true,
				foldGutter: true,
				gutters:["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
			});
			editor1.on('change', () => {
				clearInterval(interval);
				displayDiff();
			});
			var editor2 = CodeMirror.fromTextArea(document.getElementById('code2'), {
				lineNumbers: true,
				indentUnit: 4,
				mode: 'text/x-perl',
				matchBrackets: true,
				theme: 'mdn-like',
				styleActiveLine: true,
				lineWrapping:true,
				foldGutter: true,
				gutters:["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
			});
			editor2.on('change', () => {
				clearInterval(interval);
				displayDiff();
			});
			function compareTexts() {
				var t1 = editor1.getDoc().getValue("\n");
				var t2 = editor2.getDoc().getValue("\n");
				var diff = Diff.createPatch("diff", t1, t2);
				return diff;
			}
			function displayDiff(e) {
				var diff = compareTexts();
				var diffContainer = document.getElementById("diff");
				var diffUI = new Diff2HtmlUI(diffContainer, diff, {
					inputFormat: 'diff',
					drawFileList: false,
					matching: 'lines',
					outputFormat: 'side-by-side'
				});
				diffUI.draw();
			}
			interval = setInterval(displayDiff, 1000);
			function setLangMode(event) {
				var mode = event.target.value;
				editor1.setOption("mode", mode);
				editor2.setOption("mode", mode);
			}
			function setTheme(event) {
				var theme = event.target.value;
				editor1.setOption("theme", theme);
				editor2.setOption("theme", theme);
			}
		</script>
	</body>
</html>